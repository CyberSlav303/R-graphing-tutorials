---
title: "Creating histograms in R using ggplot2"
author: 
  - Jodie Burchell
  - Mauricio Vargas Sepúlveda 帕夏
date: "`r Sys.Date()`"
output: 
      rmarkdown::html_vignette:
        css: css/entries.css
---

```{r setup, cache = FALSE, echo = FALSE, message = FALSE, warning = FALSE, tidy = FALSE}
knitr::opts_chunk$set(message = F, error = F, warning = F, comment = NA, fig.align = 'center', dpi = 100, fig.width=6, fig.height=5, tidy = F, cache.path = '.cache/', fig.path = 'Line/')
```

In this tutorial we will demonstrate some of the many options the `ggplot2` package has for creating and customising histograms. We will use an international trade [dataset](http://insert.url) made by ourselves from different sources (Chile Customs, Central Bank of Chile and General Directorate of International Economic Relations).

The first thing to do is load in the data and libraries, as below:
```{r load_in_data, cache=TRUE}
library(ggplot2)

# install.packages('ggthemes', dependencies = TRUE)
library(ggthemes)
library(extrafont)
#fonts()
#font_import(pattern="[A/a]tlas")
#font_import(pattern="[T/t]ahoma")
#font_import(pattern="[O/o]fficina")

charts.data <- read.csv("charts.csv")
```

In this tutorial, we will work towards creating the line plot below. We will take you from a basic line plot and explain all the customisations we add to the code step-by-step.
```{r finalresult, echo=FALSE}
library(ggplot2)

# install.packages('ggthemes', dependencies = TRUE)
library(ggthemes)
library(extrafont)
#fonts()
#font_import(pattern="[A/a]tlas")
#font_import(pattern="[T/t]ahoma")
#font_import(pattern="[O/o]fficina")

charts.data.2 <- read.csv("charts.csv")
charts.data.2 <- as.data.frame(charts.data.2)
charts.data.2$product <- factor(charts.data.2$product, levels = c("copper","others"), 
                              labels = c("Copper","Pulp wood, Fruit, Salmon & Others"))

colour <- c("#40b8d0", "#b2d183")

p7 <- ggplot() + 
  geom_line(aes(y = export, x = year, colour = product), size=1.5, data = charts.data.2, 
            stat="identity") + 
  theme(legend.position="bottom", legend.direction="horizontal", 
        legend.title = element_blank()) + 
  scale_x_continuous(breaks=seq(2006,2014,1)) + 
  labs(x="Year", y="USD million") + 
  ggtitle("Composition of Exports to China ($)") + 
  scale_colour_manual(values=colour) + 
  theme(axis.line = element_line(size=1, colour = "black"), 
        panel.grid.major = element_line(colour = "#d3d3d3"), panel.grid.minor = element_blank(), 
        panel.border = element_blank(), panel.background = element_blank()) + 
  theme(plot.title = element_text(size = 14, family = "Tahoma", face = "bold"), 
        text=element_text(family="Tahoma"),
        axis.text.x=element_text(colour="black", size = 10), 
        axis.text.y=element_text(colour="black", size = 10),
        legend.key=element_rect(fill="white", colour="white")) 
p7
```

## Basic graph
In order to initialise a plot we tell ggplot that `charts.data` is our data, and specify the variables on each axis. We then instruct ggplot to render this as a histogram by adding the `geom_line` command.

```{r line1, cache=TRUE, tidy=TRUE}
p7 <- ggplot() + geom_line(aes(y = export, x = year, colour = product), 
                           data = charts.data, stat="identity")
p7
```

## Adjusting line width
To change the line width, we add a `size` argument to `geom_line`.
```{r line2, cache=TRUE}
p7 <- ggplot() + geom_line(aes(y = export, x = year, colour = product), size=1.5, 
                           data = charts.data, stat="identity")
p7
```

## Changing variables display
To change the variables displayed name, we need to re-factor our data labels in `charts.data` data frame. Then we move the legend to the bottom using `theme` command.
```{r line3, cache=TRUE}
charts.data <- as.data.frame(charts.data)
charts.data$product <- factor(charts.data$product, levels = c("copper","others"), 
                              labels = c("Copper","Pulp wood, Fruit, Salmon & Others"))

p7 <- ggplot() + geom_line(aes(y = export, x = year, colour = product), size=1.5, 
                           data = charts.data, stat="identity") +
  theme(legend.position="bottom", legend.direction="horizontal", legend.title = element_blank())
p7
```

## Adjusting x-axis scale
To change the axis tick marks, we use `scale_x_continuous` and/or `scale_y_continuous` command.

```{r line4, cache=TRUE}
p7 <- p7 + scale_x_continuous(breaks=seq(2006,2014,1))
p7
```

## Adjusting axis labels & adding title
To add a title, we include the option `ggtitle` and include the name of the graph as a string argument, and to change the axis names we use `ggtitle` command.
```{r line5, cache=TRUE}
p7 <- p7 + ggtitle("Composition of Exports to China ($)") + labs(x="Year", y="USD million") 
p7
```

## Adjusting color palette
To change the colours, we use `scale_colour_manual` command.
```{r line6, cache=TRUE}
colour <- c("#5F9EA0", "#E1B378")
p7 <- p7 + scale_colour_manual(values=colour)
p7
```

## Using white theme
We'll start using a simple theme customisation made adding `theme_bw() ` after `ggplot()`. That theme argument can be modified to use different themes.
```{r line7, cache=TRUE}
p7 <- ggplot() + theme_bw() +
  geom_line(aes(y = export, x = year, colour = product), size=1.5, data = charts.data, 
            stat="identity") + 
  theme(legend.position="bottom", legend.direction="horizontal", 
        legend.title = element_blank()) + 
  scale_x_continuous(breaks=seq(2006,2014,1)) + 
  labs(x="Year", y="USD million") + 
  ggtitle("Composition of Exports to China ($)") + 
  scale_colour_manual(values=colour)
p7
```

## Using 'The Economist' theme 
There are a wider range of pre-built themes available as part of the `ggthemes` package (more information on these [here](https://cran.r-project.org/web/packages/ggthemes/vignettes/ggthemes.html)). Below I've applied `theme_economist()`, which approximates graphs in the Economist magazine. It is also important that the font change argument inside `theme` is optional and it's only to obtain a more similar result compared to the original.
```{r line8, cache=TRUE}
p7 <- ggplot() + theme_economist() + scale_colour_economist() +
  theme(plot.title=element_text(family="OfficinaSanITC-Book"),
        text=element_text(family="OfficinaSanITC-Book")) +
  geom_line(aes(y = export, x = year, colour = product), size=1.5, data = charts.data, 
            stat="identity") + 
  theme(legend.position="bottom", legend.direction="horizontal", 
        legend.title = element_blank()) + 
  scale_x_continuous(breaks=seq(2006,2014,1)) + 
  labs(x="Year", y="USD million") + 
  ggtitle("Composition of Exports to China ($)")
p7
```

## Using 'Five Thirty Eight' theme 
Below I've applied `theme_fivethirtyeight()`, which approximates graphs in the nice [FiveThirtyEight](http://fivethirtyeight.com/) website. Again, it is also important that the font change is optional and it's only to obtain a more similar result compared to the original.
```{r line9, cache=TRUE}
p7 <- ggplot() + theme_fivethirtyeight() + scale_colour_fivethirtyeight() +
  theme(plot.title=element_text(family="Atlas Grotesk Medium"), 
        text=element_text(family="Atlas Grotesk Light")) +
  geom_line(aes(y = export, x = year, colour = product), size=1.5, data = charts.data, 
            stat="identity") + 
  theme(legend.position="bottom", legend.direction="horizontal", 
        legend.title = element_blank()) + 
  scale_x_continuous(breaks=seq(2006,2014,1)) + 
  labs(x="Year", y="USD million") + 
  ggtitle("Composition of Exports to China ($)")
p7
```

## Creating an XKCD style chart
Of course, you may want to create your own themes as well. `ggplot2` allows for a very high degree of customisation, including allowing you to use imported fonts. Below is an example of a theme I able to create which mimics the visual style of [XKCD](http://xkcd.com/). In order to create this chart, you first need to import the XKCD font, install it on your machine and load it into R using the `extrafont` package.
These instructions are taken from [here](https://www.google.com.au/url?sa=t&rct=j&q=&esrc=s&source=web&cd=1&ved=0ahUKEwiWzafchdPJAhVBpJQKHe_LDT8QFggbMAA&url=https%3A%2F%2Fcran.r-project.org%2Fweb%2Fpackages%2Fxkcd%2Fvignettes%2Fxkcd-intro.pdf&usg=AFQjCNE-KciGY14e-Q1buYIVmTFC0ht__Q&sig2=DZUwkvIHwfNWtTtkcz94jg):
```{r line10, cache=TRUE}
#font_import(pattern="[X/x]kcd")
#fonts()

fill <- c("#56B4E9", "#ff69b4")

p8 <- ggplot() + 
  geom_line(aes(y = export, x = year, colour = product), size=1.5, data = charts.data, 
            stat="identity") + 
  theme(legend.position="bottom", legend.direction="horizontal", 
        legend.title = element_blank()) + 
  scale_x_continuous(breaks=seq(2006,2014,1)) + 
  labs(x="Year", y="USD million") + 
  ggtitle("Composition of Exports to China ($)") + 
  scale_color_manual(values=fill) + 
  theme(axis.line = element_line(size=1, colour = "black"), panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(), panel.border = element_blank(), 
        panel.background = element_blank()) + 
  theme(plot.title=element_text(family="xkcd-Regular"), text=element_text(family="xkcd-Regular"), 
        axis.text.x=element_text(colour="black", size = 10), 
        axis.text.y=element_text(colour="black", size = 10),
        legend.key=element_rect(fill="white", colour="white")) 
p8
```

## Creating your own theme
As before, you can modify your plots a lot as `ggplot2` allows many customisation. Here we present out original result shown at the top of page. 
```{r line11, cache=TRUE}
fill <- c("#40b8d0", "#b2d183")

p7 <- ggplot() + 
  geom_line(aes(y = export, x = year, colour = product), size=1.5, data = charts.data, 
            stat="identity") + 
  theme(legend.position="bottom", legend.direction="horizontal", 
        legend.title = element_blank()) + 
  scale_x_continuous(breaks=seq(2006,2014,1)) + 
  labs(x="Year", y="USD million") + 
  ggtitle("Composition of Exports to China ($)") + 
  scale_colour_manual(values=colour) + 
  theme(axis.line = element_line(size=1, colour = "black"), 
        panel.grid.major = element_line(colour = "#d3d3d3"), panel.grid.minor = element_blank(), 
        panel.border = element_blank(), panel.background = element_blank()) + 
  theme(plot.title = element_text(size = 14, family = "Tahoma", face = "bold"), 
        text=element_text(family="Tahoma"),
        axis.text.x=element_text(colour="black", size = 10), 
        axis.text.y=element_text(colour="black", size = 10),
        legend.key=element_rect(fill="white", colour="white")) 
p7
```
